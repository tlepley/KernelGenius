#ifndef BORDER
# define BORDER undef
#endif

kernel Merge(int width=[1:1920], int height=[1:1080],
	     float in0[height][width],float in1[height][width]) {
   	  	
	Filter<float> merge(in0,in1) {
		.border = BORDER;
		.function= ${
	  	 @merge[0][0]=1.* ($in0[-2][-2]-$in1[-2][-2])+2. *($in0[-2][-1]-$in1[-2][-1])+3.* ($in0[-2][0]-$in1[-2][0])+4.* ($in0[-2][1]-$in1[-2][1])+5. *($in0[-2][2]-$in1[-2][2])+
			     6.* ($in0[-1][-2]-$in1[-1][-2])+7. *($in0[-1][-1]-$in1[-1][-1])+8.* ($in0[-1][0]-$in1[-1][0])+9.* ($in0[-1][1]-$in1[-1][1])+10.*($in0[-1][2]-$in1[-1][2])+
			     1.5*($in0[0] [-2]-$in1[0][-2])  +2.5*($in0[0][-1]-$in1[0][-1])  +3.5*($in0[0][0]-$in1[0][0])  +4.5*($in0[0][1]-$in1[0][1])  +5.5*($in0[0][2]-$in1[0][2])+
			     -1.*($in0[1][-2]-$in1[1][-2])  -2. *($in0[1][-1]-$in1[1][-1])  -3.* ($in0[1][0]-$in1[1][0])-4.* ($in0[1][1]-$in1[1][1])  -5.* ($in0[1][2]-$in1[1][2])+
			     -6.*($in0[2][-2]-$in1[2][-2])  -7. *($in0[2][-1]-$in1[2][-1])  -8.* ($in0[2][0]-$in1[2][0])-9.* ($in0[2][1]-$in1[2][1])  -10.*($in0[2][2]-$in1[2][2]);
		}$;
	};
	
	return merge;
}

